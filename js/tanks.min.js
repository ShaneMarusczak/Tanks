(function(){function F(a){return new Promise(b=>setTimeout(b,a))}function da(a){Q();if(R&&!n&&w){var b=a.target;b=[b.id.split("-")[1],b.id.split("-")[2]];let [c,d]=b;b=h[c][d];b.start_cell||b.end_cell||b.wall||(b.wall=!0,a.target.classList.add("wall"))}}function l(a,b){return document.getElementById("cell-"+a+"-"+b)}function L(a){return document.getElementById("cell-"+a.x+"-"+a.y)}function S(a=!0){for(let b=0;b<p;b++)for(let c=0;c<q;c++){let d=h[b][c],e=l(b,c);d.path=!1;d.wall||(a&&(d.end_cell=!1,
e.classList.remove("end")),e.classList.remove("path"),d.visited=!1,d.distance=0,e.textContent="")}}function ea(){let a;for(let b of m.neighbors){let c=h[b.x][b.y];if(c.end_cell){M("Enemy crashed into you.");return}if(c.path){a=c;break}}m.start_cell=!1;l(m.x,m.y).classList.remove("start");m.path=!1;a.start_cell=!0;m=a;l(a.x,a.y).classList.add("start");S(!1);N(v);B&&G(m)}function M(a){Array.from(document.getElementsByClassName("laser")).forEach(b=>b.remove());alert(a);A=!0;document.getElementById("reload").classList.remove("notShown")}
function Q(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function T(){U&&V&&!n&&(Q(),r.removeEventListener("click",T),r.disabled=!0,r.blur(),r.classList.add("hidden"),document.getElementById("wallMessage").classList.add("notShown"),document.getElementById("pause").classList.remove("hidden"),document.getElementById("reload").classList.add("notShown"),Array.from(document.querySelectorAll(".cell")).forEach(a=>{a.removeEventListener("mouseover",
W);a.removeEventListener("mouselout",X)}),n=!0,w=!1,N(v),fa(),B?(G(m),window.focus(),Y(),Z()):B||(document.getElementById("wallMessage").classList.add("hidden"),document.getElementById("noPathMessage").classList.remove("hidden")))}function fa(){for(let a=0;a<p;a++)for(let b=0;b<q;b++)l(a,b).classList.remove("cell_hover")}function ha(a){const b=[];"N"===k?(b.push(a.offsetLeft-3.5+a.offsetWidth/2),b.push(a.offsetTop-a.offsetHeight/2)):"S"===k?(b.push(a.offsetLeft-3.5+a.offsetWidth/2),b.push(a.offsetTop+
a.offsetHeight/2)):"E"===k?(b.push(a.offsetLeft+a.offsetWidth),b.push(a.offsetTop)):"W"===k?(b.push(a.offsetLeft-3.5),b.push(a.offsetTop)):"NW"===k?(b.push(a.offsetLeft),b.push(a.offsetTop-a.offsetHeight/2)):"NE"===k?(b.push(a.offsetLeft-3.5+a.offsetWidth),b.push(a.offsetTop-a.offsetHeight/2)):"SW"===k?(b.push(a.offsetLeft),b.push(a.offsetTop+a.offsetHeight/2)):"SE"===k&&(b.push(a.offsetLeft+a.offsetWidth-3.5),b.push(a.offsetTop+a.offsetHeight/2));return b}function aa(){const a=document.createElement("div");
a.classList.add("laser");const [b,c]=ha(L(v));a.style.left=b+"px";a.style.top=c+"px";const d=20*ia[k],e=20*ja[k];a.style.transform="rotate("+ka[k]+"deg)";C.appendChild(a);for(let g=0;30>g;g++)F(25*g).then(()=>{a.style.top=c-e*g+"px";a.style.left=b-d*g+"px";H(a,C)||a.remove();H(a,L(m))&&(document.getElementsByClassName("start")[0].classList.remove("start"),M("You shot the enemy tank!"));Array.from(document.getElementsByClassName("wall")).forEach(x=>{H(a,x)&&a.remove()});Array.from(document.getElementsByClassName("edge")).forEach(x=>
{H(a,x)&&a.remove()})});F(600).then(()=>a.remove())}async function Z(){for(;!A&&!y;){var a=z.dequeue();if("undefined"!==typeof a&&null!==a){var b=void 0;a=a.description;for(let c of v.neighbors)if(c.direction===a){b=h[c.x][c.y];break}"undefined"===typeof b||null===b||b.wall||(b.start_cell?M("You ran into the enemy tank"):(S(),b.end_cell=!0,L(b).classList.add("end"),v=b,N(v),B&&G(m),k=a))}b=D.dequeue();"undefined"!==typeof b&&null!==b&&f[" "]&&aa();b=O();for(let c of b){if(b="move"===c.type&&I())a:{b=
c.description;for(let d of v.neighbors)if(d.direction===b){b=h[d.x][d.y];if("undefined"===typeof b||null===b)break;if(b.wall)break;b=!0;break a}b=!1}b&&z.enqueue(c);"fire"===c.type&&D.enqueue(c)}await F(100)}}async function Y(){for(;!A&&!y;)la(),await F(ba)}function la(){ba=Array.from(document.getElementById("difficulty").options).find(a=>a.selected).value;ea()}function G(a){a.path=!0;0!==a.distance&&(a.start_cell||(l(a.x,a.y).classList.remove("visited"),l(a.x,a.y).classList.add("path")),G(a.getLowestDistanceNeighbor()))}
function N(a){const b=new Queue;a.visited=!0;for(b.enqueue(a);!b.isEmpty();){a=b.dequeue();if(a.start_cell)break;for(let c of a.neighbors.reverse()){let d=h[c.x][c.y];"NE"===c.direction&&J("N","E",a,"NE")?a.neighbors.splice(a.neighbors.indexOf(c),1):"SE"===c.direction&&J("S","E",a,"SE")?a.neighbors.splice(a.neighbors.indexOf(c),1):"SW"===c.direction&&J("S","W",a,"SW")?a.neighbors.splice(a.neighbors.indexOf(c),1):"NW"===c.direction&&J("N","W",a,"NW")?a.neighbors.splice(a.neighbors.indexOf(c),1):(d.start_cell&&
(B=!0),d.distance>a.distance+c.connection_cost&&d.visited&&(d.distance=a.distance+c.connection_cost),d.visited||d.wall||(d.visited=!0,d.distance=a.distance+c.connection_cost,l(d.x,d.y),d.wall||b.enqueue(d)))}}}function J(a,b,c,d){let e=null,g=null,x=null;for(let t of c.neighbors)t.direction===a&&(e=h[t.x][t.y]),t.direction===b&&(g=h[t.x][t.y]),t.direction===d&&(x=h[t.x][t.y]);return null===e||null===g||null===x?!1:e.wall&&g.wall?!x.wall:!1}function ma(a){n||ca||(a.target.classList.add("hidden"),r.disabled=
!1,r.classList.remove("hidden"),q=p=a=Array.from(document.getElementById("mapSize").options).find(b=>b.selected).value,document.getElementById("mapSizeDropdown").classList.add("hidden"),na(),ca=!0,document.getElementById("startMessage").classList.remove("hidden"),r.scrollIntoView({behavior:"smooth"}))}function P(a){R=void 0===a.buttons?1===a.which:1===a.buttons}function na(){for(let a=0;a<p;a++){h.push([]);const b=document.createElement("div");b.id="col-"+a;b.classList.add("col");b.draggable=!1;b.ondragstart=
function(){return!1};C.appendChild(b);for(let c=0;c<q;c++){const d=new oa(a,c);h[a].push(d);h[a][c].setNeighbors();const e=document.createElement("div");e.id="cell-"+a+"-"+c;e.classList.add("cell");e.classList.add("cell_hover");0!==a&&a!==p-1&&0!==c&&c!==q-1||e.classList.add("edge");625>p*q?e.classList.add("large_cell"):1600>p*q?e.classList.add("medium_cell"):3600>p*q?e.classList.add("small_cell"):e.classList.add("x-small_cell");b.appendChild(e);e.addEventListener("mouseup",g=>d.handleClick(g));e.addEventListener("mouseover",
W);e.addEventListener("mouseout",X);e.draggable=!1;e.ondragstart=function(){return!1}}}}function W(a){K?a.target.classList.add("startHighlight"):E?a.target.classList.add("endHighlight"):w&&a.target.classList.add("wallHighlight")}function X(a){a.target.classList.remove("startHighlight");a.target.classList.remove("endHighlight");a.target.classList.remove("wallHighlight")}function I(){const a=f.ArrowUp||f.w||f.W,b=f.ArrowDown||f.s||f.S,c=f.ArrowLeft||f.a||f.A,d=f.ArrowRight||f.d||f.D,e=f[" "];return a&&
b||c&&d||!(a||b||c||d||e)?!1:!0}function O(){const a=f.ArrowUp||f.w||f.W,b=f.ArrowDown||f.s||f.S,c=f.ArrowLeft||f.a||f.A,d=f.ArrowRight||f.d||f.D,e=f[" "],g=[];a&&c?g.push(new u("move","NW")):a&&d?g.push(new u("move","NE")):b&&d?g.push(new u("move","SE")):b&&c?g.push(new u("move","SW")):b?g.push(new u("move","S")):a?g.push(new u("move","N")):c?g.push(new u("move","W")):d&&g.push(new u("move","E"));e&&g.push(new u("fire","playertank"));return g}function pa(a){-1<["Space","ArrowUp","ArrowDown","ArrowLeft",
"ArrowRight"].indexOf(a.code)&&a.preventDefault();if(n&&!A&&(f[a.key]=!0,!y&&I())){" "!==a.key&&z.empty();a=O();for(let b of a)"move"===b.type&&z.enqueue(b)}}function qa(a){-1<["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(a.code)&&a.preventDefault();if(n&&!A&&(f[a.key]=!1,!y)){" "!==a.key?z.empty():" "===a.key&&(aa(),D.empty());a=O();for(let b of a)"move"===b.type&&I()?z.enqueue(b):"fire"===b.type&&I()&&D.enqueue(b)}}let n=!1,A=!1,y=!1,ca=!1,ba=150,q=30,p=30,K=!0,E=!1,w=!1,U=!1,
V=!1,R=!1,B=!1,m,v;const h=[],z=new Queue,D=new Queue;let k="N";const C=document.getElementById("gameBoard_UI"),r=document.getElementById("start");class u{constructor(a,b){this.type=a;this.description=b}}class oa{constructor(a,b){this.x=a;this.y=b;this.neighbors=[];this.cardinal_neighbors=[];this.end_cell=this.start_cell=this.path=this.wall=!1;this.distance=0;this.visited=!1}setNeighbors(){const a=[-1,0,1];for(let d of a)for(let e of a){var b=this.x+d,c=this.y+e;0<=b&&b<p&&0<=c&&c<q&&(0!==d||0!==
e)&&(b=0===d&&-1===e?"N":1===d&&-1===e?"NE":1===d&&0===e?"E":1===d&&1===e?"SE":0===d&&1===e?"S":-1===d&&1===e?"SW":-1===d&&0===e?"W":"NW",0===d||0===e?(this.neighbors.push({x:this.x+d,y:this.y+e,connection_cost:1,direction:b}),this.cardinal_neighbors.push({x:this.x+d,y:this.y+e,connection_cost:1,direction:b})):this.neighbors.push({x:this.x+d,y:this.y+e,connection_cost:Math.sqrt(2),direction:b}))}}getLowestDistanceNeighbor(){let a=Infinity,b=null;for(let c of this.neighbors){let d=h[c.x][c.y];d.distance<
a&&d.visited&&!d.wall&&(a=d.distance,b=d)}return b}handleClick(a){if(!K||n||w||0!==a.button)if(!E||n||w||0!==a.button)E||K||!w||n||2!==a.button||(this.wall=!1,l(this.x,this.y).classList.remove("wall"));else for(v=this,this.end_cell=!0,l(this.x,this.y).classList.add("end"),E=!1,V=!0,document.getElementById("endMessage").classList.add("hidden"),document.getElementById("wallMessage").classList.remove("hidden"),w=!0,a=0;a<p;a++)for(let b=0;b<q;b++)l(a,b).addEventListener("mouseover",da);else this.start_cell=
!0,l(this.x,this.y).classList.add("start"),m=this,K=!1,U=E=!0,document.getElementById("startMessage").classList.add("hidden"),document.getElementById("endMessage").classList.remove("hidden")}}const ia={N:0,S:0,E:-1,W:1,NE:-1,NW:1,SE:-1,SW:1},ja={N:1,S:-1,E:0,W:0,NE:1,NW:1,SE:-1,SW:-1},ka={N:0,S:0,E:90,W:90,NE:45,NW:-45,SE:-45,SW:45},H=(a,b)=>!(b.offsetLeft>a.offsetWidth+a.offsetLeft||a.offsetLeft>b.offsetWidth+b.offsetLeft||b.offsetTop>a.offsetHeight+a.offsetTop||a.offsetTop>b.offsetHeight+b.offsetTop),
f={};(function(){r.addEventListener("click",T);document.getElementById("buildGrid").addEventListener("click",ma);document.getElementById("pause").addEventListener("click",()=>{!A&&n&&((y=!y)?(z.empty(),D.empty(),document.getElementById("reload").classList.remove("notShown")):(Y(),Z(),document.getElementById("reload").classList.add("notShown")),document.getElementById("pause").textContent=y?"Unpause":"Pause")});document.body.onmousedown=P;document.body.onmousemove=P;document.body.onmouseup=P;document.addEventListener("keydown",
pa);document.addEventListener("keyup",qa);r.disabled=!0;document.oncontextmenu=()=>!1;document.draggable=!1;document.ondragstart=function(){return!1};document.getElementById("difficulty").addEventListener("change",()=>{document.getElementById("difficulty").blur()});C.draggable=!1;C.ondragstart=function(){return!1}})()})();

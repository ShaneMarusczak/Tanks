(function(){function U(a){return new Promise(b=>setTimeout(b,a))}function V(a){H();if(I&&!k&&r){var b=a.target;b=[b.id.split("-")[1],b.id.split("-")[2]];let [d,c]=b;b=g[d][c];b.start_cell||b.end_cell||b.wall||(b.wall=!0,a.target.classList.add("wall"))}}function h(a,b){return document.getElementById("cell-"+a+"-"+b)}function J(a=!0){for(let b=0;b<m;b++)for(let d=0;d<n;d++){let c=g[b][d],e=h(b,d);c.path=!1;c.wall||(a&&(c.end_cell=!1,e.classList.remove("end")),e.classList.remove("path"),c.visited=!1,
c.distance=0,e.textContent="")}}function K(a){let b;for(let d of u.neighbors)if(d.direction===a){b=g[d.x][d.y];break}"undefined"===typeof b||null===b||b.wall||(b.start_cell?L("You ran into the enemy tank"):(J(),b.end_cell=!0,document.getElementById("cell-"+b.x+"-"+b.y).classList.add("end"),u=b,C(u),w&&z(l)))}function W(){let a;for(let b of l.neighbors){let d=g[b.x][b.y];if(d.end_cell){L("Enemy crashed into you.");return}if(d.path){a=d;break}}l.start_cell=!1;h(l.x,l.y).classList.remove("start");l.path=
!1;a.start_cell=!0;l=a;h(a.x,a.y).classList.add("start");J(!1);C(u);w&&z(l)}function L(a){alert(a);v=!0;document.getElementById("reload").classList.remove("notShown")}function X(){const a=document.getElementById("start");a.removeEventListener("click",a);a.disabled=!0;a.blur();a.classList.add("hidden");document.getElementById("wallMessage").classList.add("notShown");document.getElementById("pause").classList.remove("hidden");document.getElementById("reload").classList.add("notShown")}function H(){window.getSelection?
window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function Y(){M&&N&&!k&&(H(),X(),Array.from(document.querySelectorAll(".cell")).forEach(a=>{a.removeEventListener("mouseover",O);a.removeEventListener("mouselout",P)}),k=!0,r=!1,C(u),Z(),w?(z(l),window.focus(),D()):w||(document.getElementById("wallMessage").classList.add("hidden"),document.getElementById("noPathMessage").classList.remove("hidden")))}function Z(){for(let a=0;a<m;a++)for(let b=0;b<n;b++)h(a,b).classList.remove("cell_hover")}
function D(){v||q||(aa(),v||q||U(Q).then(()=>D()))}function aa(){Q=Array.from(document.getElementById("difficulty").options).find(a=>a.selected).value;W()}function z(a){a.path=!0;0!==a.distance&&(a.start_cell||(h(a.x,a.y).classList.remove("visited"),h(a.x,a.y).classList.add("path")),z(a.getLowestDistanceNeighbor()))}function C(a){let b=new x;a.visited=!0;for(b.enqueue(a);!b.isEmpty();){a=b.dequeue();if(a.start_cell)break;for(let d of a.neighbors.reverse()){let c=g[d.x][d.y];"NE"===d.direction&&A("N",
"E",a,"NE")?a.neighbors.splice(a.neighbors.indexOf(d),1):"SE"===d.direction&&A("S","E",a,"SE")?a.neighbors.splice(a.neighbors.indexOf(d),1):"SW"===d.direction&&A("S","W",a,"SW")?a.neighbors.splice(a.neighbors.indexOf(d),1):"NW"===d.direction&&A("N","W",a,"NW")?a.neighbors.splice(a.neighbors.indexOf(d),1):(c.start_cell&&(w=!0),c.distance>a.distance+d.connection_cost&&c.visited&&(c.distance=a.distance+d.connection_cost),c.visited||c.wall||(c.visited=!0,c.distance=a.distance+d.connection_cost,h(c.x,
c.y),c.wall||b.enqueue(c)))}}}function A(a,b,d,c){let e=null,t=null,E=null;for(let p of d.neighbors)p.direction===a&&(e=g[p.x][p.y]),p.direction===b&&(t=g[p.x][p.y]),p.direction===c&&(E=g[p.x][p.y]);return null===e||null===t||null===E?!1:e.wall&&t.wall?!E.wall:!1}function ba(a){k||R||(a.target.classList.add("hidden"),document.getElementById("start").disabled=!1,document.getElementById("start").classList.remove("hidden"),n=m=a=Array.from(document.getElementById("mapSize").options).find(b=>b.selected).value,
document.getElementById("mapSizeDropdown").classList.add("hidden"),document.getElementById("tankSvg").classList.add("hidden"),ca(),R=!0,document.getElementById("introMessage").classList.add("hidden"),document.getElementById("startMessage").classList.remove("hidden"))}function F(a){I=void 0===a.buttons?1===a.which:1===a.buttons}function ca(){for(let a=0;a<m;a++){g.push([]);const b=document.createElement("div");b.id="col-"+a;b.classList.add("col");b.draggable=!1;b.ondragstart=function(){return!1};G.appendChild(b);
for(let d=0;d<n;d++){const c=new da(a,d);g[a].push(c);g[a][d].setNeighbors();const e=document.createElement("div");e.id="cell-"+a+"-"+d;e.classList.add("cell");e.classList.add("cell_hover");625>m*n?e.classList.add("large_cell"):1600>m*n?e.classList.add("medium_cell"):3600>m*n?e.classList.add("small_cell"):e.classList.add("x-small_cell");b.appendChild(e);e.addEventListener("mouseup",t=>c.handleClick(t));e.addEventListener("mouseover",O);e.addEventListener("mouseout",P);e.draggable=!1;e.ondragstart=
function(){return!1}}}}function O(a){B?a.target.classList.add("startHighlight"):y?a.target.classList.add("endHighlight"):r&&a.target.classList.add("wallHighlight")}function P(a){a.target.classList.remove("startHighlight");a.target.classList.remove("endHighlight");a.target.classList.remove("wallHighlight")}function S(){const a=f.ArrowUp||f.w||f.W,b=f.ArrowDown||f.s||f.S,d=f.ArrowLeft||f.a||f.A,c=f.ArrowRight||f.d||f.D;if(a&&b||d&&c||!(a||b||d||c))return!1;let e=0;Object.values(f).forEach(t=>{t&&e++});
return 3>e}function T(){const a=f.ArrowUp||f.w||f.W,b=f.ArrowDown||f.s||f.S,d=f.ArrowLeft||f.a||f.A,c=f.ArrowRight||f.d||f.D;return a&&d?"NW":a&&c?"NE":b&&c?"SE":b&&d?"SW":b?"S":a?"N":d?"W":c?"E":""}function ea(a){k&&!v&&(f[a.key]=!0,!q&&S()&&K(T()))}function fa(a){k&&!v&&(f[a.key]=!1,!q&&S()&&K(T()))}let k=!1,v=!1,q=!1,R=!1,Q=150,n=30,m=30,B=!0,y=!1,r=!1,M=!1,N=!1,I=!1,w=!1,l,u;const g=[],G=document.getElementById("gameBoard_UI");class da{constructor(a,b){this.x=a;this.y=b;this.neighbors=[];this.cardinal_neighbors=
[];this.end_cell=this.start_cell=this.path=this.wall=!1;this.distance=0;this.visited=!1}setNeighbors(){const a=[-1,0,1];for(let c of a)for(let e of a){var b=this.x+c,d=this.y+e;0<=b&&b<m&&0<=d&&d<n&&(0!==c||0!==e)&&(b=0===c&&-1===e?"N":1===c&&-1===e?"NE":1===c&&0===e?"E":1===c&&1===e?"SE":0===c&&1===e?"S":-1===c&&1===e?"SW":-1===c&&0===e?"W":"NW",0===c||0===e?(this.neighbors.push({x:this.x+c,y:this.y+e,connection_cost:1,direction:b}),this.cardinal_neighbors.push({x:this.x+c,y:this.y+e,connection_cost:1,
direction:b})):this.neighbors.push({x:this.x+c,y:this.y+e,connection_cost:Math.sqrt(2),direction:b}))}}getLowestDistanceNeighbor(){let a=Infinity,b=null;for(let d of this.neighbors){let c=g[d.x][d.y];c.distance<a&&c.visited&&!c.wall&&(a=c.distance,b=c)}return b}handleClick(a){if(!B||k||r||0!==a.button)if(!y||k||r||0!==a.button)y||B||!r||k||2!==a.button||(this.wall=!1,h(this.x,this.y).classList.remove("wall"));else for(u=this,this.end_cell=!0,h(this.x,this.y).classList.add("end"),y=!1,N=!0,document.getElementById("endMessage").classList.add("hidden"),
document.getElementById("wallMessage").classList.remove("hidden"),r=!0,a=0;a<m;a++)for(let b=0;b<n;b++)h(a,b).addEventListener("mouseover",V);else this.start_cell=!0,h(this.x,this.y).classList.add("start"),l=this,B=!1,M=y=!0,document.getElementById("startMessage").classList.add("hidden"),document.getElementById("endMessage").classList.remove("hidden")}}const f={};(function(){document.getElementById("start").addEventListener("click",Y);document.getElementById("buildGrid").addEventListener("click",
ba);document.getElementById("pause").addEventListener("click",()=>{!v&&k&&((q=!q)||D(),document.getElementById("pause").textContent=q?"Unpause":"Pause",q?document.getElementById("reload").classList.remove("notShown"):document.getElementById("reload").classList.add("notShown"))});document.body.onmousedown=F;document.body.onmousemove=F;document.body.onmouseup=F;document.addEventListener("keydown",ea);document.addEventListener("keyup",fa);document.getElementById("start").disabled=!0;document.oncontextmenu=
()=>!1;document.draggable=!1;document.ondragstart=function(){return!1};document.getElementById("difficulty").addEventListener("change",()=>{document.getElementById("difficulty").blur()});G.draggable=!1;G.ondragstart=function(){return!1}})();class x{constructor(){this.elements=[]}}x.prototype.enqueue=function(a){this.elements.push(a)};x.prototype.dequeue=function(){return this.elements.shift()};x.prototype.isEmpty=function(){return 0===this.elements.length};x.prototype.length=function(){return this.elements.length}})();

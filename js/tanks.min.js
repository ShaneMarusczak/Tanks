(function(){function C(a){return new Promise(b=>setTimeout(b,a))}function ba(a){N();if(O&&!l&&v){var b=a.target;b=[b.id.split("-")[1],b.id.split("-")[2]];let [d,c]=b;b=h[d][c];b.start_cell||b.end_cell||b.wall||(b.wall=!0,a.target.classList.add("wall"))}}function k(a,b){return document.getElementById("cell-"+a+"-"+b)}function P(a=!0){for(let b=0;b<n;b++)for(let d=0;d<p;d++){let c=h[b][d],e=k(b,d);c.path=!1;c.wall||(a&&(c.end_cell=!1,e.classList.remove("end")),e.classList.remove("path"),c.visited=!1,
c.distance=0,e.textContent="")}}function ca(){let a;for(let b of m.neighbors){let d=h[b.x][b.y];if(d.end_cell){Q("Enemy crashed into you.");return}if(d.path){a=d;break}}m.start_cell=!1;k(m.x,m.y).classList.remove("start");m.path=!1;a.start_cell=!0;m=a;k(a.x,a.y).classList.add("start");P(!1);J(q);z&&D(m)}function Q(a){alert(a);y=!0;document.getElementById("reload").classList.remove("notShown")}function N(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}
function R(){S&&T&&!l&&(N(),r.removeEventListener("click",R),r.disabled=!0,r.blur(),r.classList.add("hidden"),document.getElementById("wallMessage").classList.add("notShown"),document.getElementById("pause").classList.remove("hidden"),document.getElementById("reload").classList.add("notShown"),Array.from(document.querySelectorAll(".cell")).forEach(a=>{a.removeEventListener("mouseover",U);a.removeEventListener("mouselout",V)}),l=!0,v=!1,J(q),da(),z?(D(m),window.focus(),W(),X()):z||(document.getElementById("wallMessage").classList.add("hidden"),
document.getElementById("noPathMessage").classList.remove("hidden")))}function da(){for(let a=0;a<n;a++)for(let b=0;b<p;b++)k(a,b).classList.remove("cell_hover")}function Y(){const a=document.createElement("div");a.classList.add("laser");const b=document.getElementById("cell-"+q.x+"-"+q.y);a.style.left=b.offsetLeft-b.offsetWidth/2+"px";a.style.top=b.offsetTop-b.offsetHeight/2+"px";const d=20*ea[E],c=20*fa[E];a.style.transform="rotate("+ha[E]+"deg)";F.appendChild(a);for(let e=0;30>e;e++)C(25*e).then(()=>
{a.style.top=b.offsetTop-c*e+"px";a.style.left=b.offsetLeft-d*e+"px"});C(600).then(()=>a.remove())}async function X(){for(;!y&&!w;){var a=x.dequeue();if("undefined"!==typeof a&&null!==a){var b=void 0;a=a.description;for(let d of q.neighbors)if(d.direction===a){b=h[d.x][d.y];break}"undefined"===typeof b||null===b||b.wall||(b.start_cell?Q("You ran into the enemy tank"):(P(),b.end_cell=!0,document.getElementById("cell-"+b.x+"-"+b.y).classList.add("end"),q=b,J(q),z&&D(m),E=a))}b=A.dequeue();"undefined"!==
typeof b&&null!==b&&f[" "]&&Y();b=K();for(let d of b){if(b="move"===d.type&&G())a:{b=d.description;for(let c of q.neighbors)if(c.direction===b){b=h[c.x][c.y];if("undefined"===typeof b||null===b)break;if(b.wall)break;b=!0;break a}b=!1}b&&x.enqueue(d);"fire"===d.type&&A.enqueue(d)}await C(100)}}async function W(){for(;!y&&!w;)ia(),await C(Z)}function ia(){Z=Array.from(document.getElementById("difficulty").options).find(a=>a.selected).value;ca()}function D(a){a.path=!0;0!==a.distance&&(a.start_cell||
(k(a.x,a.y).classList.remove("visited"),k(a.x,a.y).classList.add("path")),D(a.getLowestDistanceNeighbor()))}function J(a){const b=new Queue;a.visited=!0;for(b.enqueue(a);!b.isEmpty();){a=b.dequeue();if(a.start_cell)break;for(let d of a.neighbors.reverse()){let c=h[d.x][d.y];"NE"===d.direction&&H("N","E",a,"NE")?a.neighbors.splice(a.neighbors.indexOf(d),1):"SE"===d.direction&&H("S","E",a,"SE")?a.neighbors.splice(a.neighbors.indexOf(d),1):"SW"===d.direction&&H("S","W",a,"SW")?a.neighbors.splice(a.neighbors.indexOf(d),
1):"NW"===d.direction&&H("N","W",a,"NW")?a.neighbors.splice(a.neighbors.indexOf(d),1):(c.start_cell&&(z=!0),c.distance>a.distance+d.connection_cost&&c.visited&&(c.distance=a.distance+d.connection_cost),c.visited||c.wall||(c.visited=!0,c.distance=a.distance+d.connection_cost,k(c.x,c.y),c.wall||b.enqueue(c)))}}}function H(a,b,d,c){let e=null,g=null,L=null;for(let t of d.neighbors)t.direction===a&&(e=h[t.x][t.y]),t.direction===b&&(g=h[t.x][t.y]),t.direction===c&&(L=h[t.x][t.y]);return null===e||null===
g||null===L?!1:e.wall&&g.wall?!L.wall:!1}function ja(a){l||aa||(a.target.classList.add("hidden"),r.disabled=!1,r.classList.remove("hidden"),p=n=a=Array.from(document.getElementById("mapSize").options).find(b=>b.selected).value,document.getElementById("mapSizeDropdown").classList.add("hidden"),document.getElementById("tankSvg").classList.add("hidden"),ka(),aa=!0,document.getElementById("introMessage").classList.add("hidden"),document.getElementById("startMessage").classList.remove("hidden"),r.scrollIntoView({behavior:"smooth"}))}
function M(a){O=void 0===a.buttons?1===a.which:1===a.buttons}function ka(){for(let a=0;a<n;a++){h.push([]);const b=document.createElement("div");b.id="col-"+a;b.classList.add("col");b.draggable=!1;b.ondragstart=function(){return!1};F.appendChild(b);for(let d=0;d<p;d++){const c=new la(a,d);h[a].push(c);h[a][d].setNeighbors();const e=document.createElement("div");e.id="cell-"+a+"-"+d;e.classList.add("cell");e.classList.add("cell_hover");625>n*p?e.classList.add("large_cell"):1600>n*p?e.classList.add("medium_cell"):
3600>n*p?e.classList.add("small_cell"):e.classList.add("x-small_cell");b.appendChild(e);e.addEventListener("mouseup",g=>c.handleClick(g));e.addEventListener("mouseover",U);e.addEventListener("mouseout",V);e.draggable=!1;e.ondragstart=function(){return!1}}}}function U(a){I?a.target.classList.add("startHighlight"):B?a.target.classList.add("endHighlight"):v&&a.target.classList.add("wallHighlight")}function V(a){a.target.classList.remove("startHighlight");a.target.classList.remove("endHighlight");a.target.classList.remove("wallHighlight")}
function G(){const a=f.ArrowUp||f.w||f.W,b=f.ArrowDown||f.s||f.S,d=f.ArrowLeft||f.a||f.A,c=f.ArrowRight||f.d||f.D,e=f[" "];return a&&b||d&&c||!(a||b||d||c||e)?!1:!0}function K(){const a=f.ArrowUp||f.w||f.W,b=f.ArrowDown||f.s||f.S,d=f.ArrowLeft||f.a||f.A,c=f.ArrowRight||f.d||f.D,e=f[" "],g=[];a&&d?g.push(new u("move","NW")):a&&c?g.push(new u("move","NE")):b&&c?g.push(new u("move","SE")):b&&d?g.push(new u("move","SW")):b?g.push(new u("move","S")):a?g.push(new u("move","N")):d?g.push(new u("move","W")):
c&&g.push(new u("move","E"));e&&g.push(new u("fire","playertank"));return g}function ma(a){-1<["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(a.code)&&a.preventDefault();if(l&&!y&&(f[a.key]=!0,!w&&G())){" "!==a.key&&x.empty();a=K();for(let b of a)"move"===b.type&&x.enqueue(b)}}function na(a){-1<["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(a.code)&&a.preventDefault();if(l&&!y&&(f[a.key]=!1,!w)){" "!==a.key?x.empty():" "===a.key&&(Y(),A.empty());a=K();for(let b of a)"move"===
b.type&&G()?x.enqueue(b):"fire"===b.type&&G()&&A.enqueue(b)}}let l=!1,y=!1,w=!1,aa=!1,Z=150,p=30,n=30,I=!0,B=!1,v=!1,S=!1,T=!1,O=!1,z=!1,m,q;const h=[],x=new Queue,A=new Queue;let E;const F=document.getElementById("gameBoard_UI"),r=document.getElementById("start");class u{constructor(a,b){this.type=a;this.description=b}}class la{constructor(a,b){this.x=a;this.y=b;this.neighbors=[];this.cardinal_neighbors=[];this.end_cell=this.start_cell=this.path=this.wall=!1;this.distance=0;this.visited=!1}setNeighbors(){const a=
[-1,0,1];for(let c of a)for(let e of a){var b=this.x+c,d=this.y+e;0<=b&&b<n&&0<=d&&d<p&&(0!==c||0!==e)&&(b=0===c&&-1===e?"N":1===c&&-1===e?"NE":1===c&&0===e?"E":1===c&&1===e?"SE":0===c&&1===e?"S":-1===c&&1===e?"SW":-1===c&&0===e?"W":"NW",0===c||0===e?(this.neighbors.push({x:this.x+c,y:this.y+e,connection_cost:1,direction:b}),this.cardinal_neighbors.push({x:this.x+c,y:this.y+e,connection_cost:1,direction:b})):this.neighbors.push({x:this.x+c,y:this.y+e,connection_cost:Math.sqrt(2),direction:b}))}}getLowestDistanceNeighbor(){let a=
Infinity,b=null;for(let d of this.neighbors){let c=h[d.x][d.y];c.distance<a&&c.visited&&!c.wall&&(a=c.distance,b=c)}return b}handleClick(a){if(!I||l||v||0!==a.button)if(!B||l||v||0!==a.button)B||I||!v||l||2!==a.button||(this.wall=!1,k(this.x,this.y).classList.remove("wall"));else for(q=this,this.end_cell=!0,k(this.x,this.y).classList.add("end"),B=!1,T=!0,document.getElementById("endMessage").classList.add("hidden"),document.getElementById("wallMessage").classList.remove("hidden"),v=!0,a=0;a<n;a++)for(let b=
0;b<p;b++)k(a,b).addEventListener("mouseover",ba);else this.start_cell=!0,k(this.x,this.y).classList.add("start"),m=this,I=!1,S=B=!0,document.getElementById("startMessage").classList.add("hidden"),document.getElementById("endMessage").classList.remove("hidden")}}const ea={N:0,S:0,E:-1,W:1,NE:-1,NW:1,SE:-1,SW:1},fa={N:1,S:-1,E:0,W:0,NE:1,NW:1,SE:-1,SW:-1},ha={N:0,S:0,E:90,W:90,NE:45,NW:-45,SE:-45,SW:45},f={};(function(){r.addEventListener("click",R);document.getElementById("buildGrid").addEventListener("click",
ja);document.getElementById("pause").addEventListener("click",()=>{!y&&l&&((w=!w)?(x.empty(),A.empty(),document.getElementById("reload").classList.remove("notShown")):(W(),X(),document.getElementById("reload").classList.add("notShown")),document.getElementById("pause").textContent=w?"Unpause":"Pause")});document.body.onmousedown=M;document.body.onmousemove=M;document.body.onmouseup=M;document.addEventListener("keydown",ma);document.addEventListener("keyup",na);r.disabled=!0;document.oncontextmenu=
()=>!1;document.draggable=!1;document.ondragstart=function(){return!1};document.getElementById("difficulty").addEventListener("change",()=>{document.getElementById("difficulty").blur()});F.draggable=!1;F.ondragstart=function(){return!1}})()})();

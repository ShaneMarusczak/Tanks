(function(){function V(a){return new Promise(b=>setTimeout(b,a))}function W(a){J();if(K&&!n&&q){var b=a.target;b=[b.id.split("-")[1],b.id.split("-")[2]];let [c,d]=b;b=g[c][d];b.start_cell||b.end_cell||b.wall||(b.wall=!0,a.target.classList.add("wall"))}}function h(a,b){return document.getElementById("cell-"+a+"-"+b)}function L(a=!0){for(let b=0;b<k;b++)for(let c=0;c<l;c++){let d=g[b][c],e=h(b,c);d.path=!1;d.wall||(a&&(d.end_cell=!1,e.classList.remove("end")),e.classList.remove("path"),d.visited=!1,
d.distance=0,e.textContent="")}}function M(a){let b;for(let c of t.neighbors)if(c.direction===a){b=g[c.x][c.y];break}"undefined"===typeof b||null===b||b.wall||(b.start_cell?(alert("You ran into the enemy tank"),u=!0):(L(),b.end_cell=!0,document.getElementById("cell-"+b.x+"-"+b.y).classList.add("end"),t=b,F(t),v&&y(m)))}function X(){let a;for(let b of m.neighbors){let c=g[b.x][b.y];if(c.end_cell){alert("Enemy crashed into you.");u=!0;return}if(c.path){a=c;break}}m.start_cell=!1;h(m.x,m.y).classList.remove("start");
m.path=!1;a.start_cell=!0;m=a;h(a.x,a.y).classList.add("start");L(!1);F(t);v&&y(m)}function Y(){const a=document.getElementById("start");a.removeEventListener("click",a);a.disabled=!0;a.blur();document.getElementById("wallMessage").classList.add("notShown")}function J(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function Z(){N&&O&&!n&&(J(),Y(),Array.from(document.querySelectorAll(".cell")).forEach(a=>{a.removeEventListener("mouseover",
P);a.removeEventListener("mouselout",Q)}),n=!0,q=!1,F(t),aa(),v?(y(m),ba(),window.focus(),R()):v||(document.getElementById("wallMessage").classList.add("hidden"),document.getElementById("noPathMessage").classList.remove("hidden")))}function aa(){for(let a=0;a<k;a++)for(let b=0;b<l;b++)h(a,b).classList.remove("cell_hover")}function R(){u||(X(),u||V(150).then(()=>R()))}function ba(){for(let a=0;a<k;a++)for(let b=0;b<l;b++){let c=g[a][b];c.visited||(c.wall=!0,h(a,b).classList.add("wall"))}}function y(a){a.path=
!0;0!==a.distance&&(a.start_cell||(h(a.x,a.y).classList.remove("visited"),h(a.x,a.y).classList.add("path")),y(a.getLowestDistanceNeighbor()))}function F(a){let b=new w;a.visited=!0;for(b.enqueue(a);!b.isEmpty();){a=b.dequeue();for(let c of a.neighbors.reverse()){let d=g[c.x][c.y];"NE"===c.direction&&z("N","E",a,"NE")?a.neighbors.splice(a.neighbors.indexOf(c),1):"SE"===c.direction&&z("S","E",a,"SE")?a.neighbors.splice(a.neighbors.indexOf(c),1):"SW"===c.direction&&z("S","W",a,"SW")?a.neighbors.splice(a.neighbors.indexOf(c),
1):"NW"===c.direction&&z("N","W",a,"NW")?a.neighbors.splice(a.neighbors.indexOf(c),1):(d.start_cell&&(v=!0),d.distance>a.distance+c.connection_cost&&d.visited&&(d.distance=a.distance+c.connection_cost),d.visited||d.wall||(d.visited=!0,d.distance=a.distance+c.connection_cost,h(d.x,d.y),d.wall||b.enqueue(d)))}}}function z(a,b,c,d){let e=null,r=null,G=null;for(let p of c.neighbors)p.direction===a&&(e=g[p.x][p.y]),p.direction===b&&(r=g[p.x][p.y]),p.direction===d&&(G=g[p.x][p.y]);return null===e||null===
r||null===G?!1:e.wall&&r.wall?!G.wall:!1}function ca(a){!n&&A&&B&&!S&&(l=Number(C.value),k=Number(D.value),C.disabled=!0,D.disabled=!0,a.target.classList.add("hidden"),document.getElementById("start").disabled=!1,document.getElementById("start").classList.remove("hidden"),da(),S=!0,document.getElementById("introMessage").classList.add("hidden"),document.getElementById("startMessage").classList.remove("hidden"))}function ea(a){/^\d{0,2}$/.test(a.target.value)&&75>=Number(a.target.value)&&0<Number(a.target.value)&&
""!==a.target.value?(A=!0,a=document.getElementById("invalidRows"),"undefined"!=typeof a&&null!=a&&a.remove()):(A&&(a=document.createElement("p"),a.id="invalidRows",a.textContent="Valid range is 1-75 rows",a.classList.add("bad"),document.getElementById("messages").insertBefore(a,document.getElementById("messages").firstChild)),A=!1)}function fa(a){/^\d{0,2}$/.test(a.target.value)&&75>=Number(a.target.value)&&0<Number(a.target.value)&&""!==a.target.value?(B=!0,a=document.getElementById("invalidCols"),
"undefined"!=typeof a&&null!=a&&a.remove()):(B&&(a=document.createElement("p"),a.id="invalidCols",a.textContent="Valid range is 1-75 columns",a.classList.add("bad"),document.getElementById("messages").insertBefore(a,document.getElementById("messages").firstChild)),B=!1)}function H(a){K=void 0===a.buttons?1===a.which:1===a.buttons}function da(){for(let a=0;a<k;a++){g.push([]);const b=document.createElement("div");b.id="col-"+a;b.classList.add("col");b.draggable=!1;b.ondragstart=function(){return!1};
I.appendChild(b);for(let c=0;c<l;c++){const d=new ha(a,c);g[a].push(d);g[a][c].setNeighbors();const e=document.createElement("div");e.id="cell-"+a+"-"+c;e.classList.add("cell");e.classList.add("cell_hover");625>k*l?e.classList.add("large_cell"):1600>k*l?e.classList.add("medium_cell"):3600>k*l?e.classList.add("small_cell"):e.classList.add("x-small_cell");b.appendChild(e);e.addEventListener("mouseup",r=>d.handleClick(r));e.addEventListener("mouseover",P);e.addEventListener("mouseout",Q);e.draggable=
!1;e.ondragstart=function(){return!1}}}}function P(a){E?a.target.classList.add("startHighlight"):x?a.target.classList.add("endHighlight"):q&&a.target.classList.add("wallHighlight")}function Q(a){a.target.classList.remove("startHighlight");a.target.classList.remove("endHighlight");a.target.classList.remove("wallHighlight")}function T(){const a=f.ArrowUp||f.w||f.W,b=f.ArrowDown||f.s||f.S,c=f.ArrowLeft||f.a||f.A,d=f.ArrowRight||f.d||f.D;if(a&&b||c&&d||!(a||b||c||d))return!1;let e=0;Object.values(f).forEach(r=>
{r&&e++});return 3>e}function U(){const a=f.ArrowUp||f.w||f.W,b=f.ArrowDown||f.s||f.S,c=f.ArrowLeft||f.a||f.A,d=f.ArrowRight||f.d||f.D;return a&&c?"NW":a&&d?"NE":b&&d?"SE":b&&c?"SW":b?"S":a?"N":c?"W":d?"E":""}function ia(a){n&&!u&&(f[a.key]=!0,T()&&M(U()))}function ja(a){n&&!u&&(f[a.key]=!1,T()&&M(U()))}let n=!1,u=!1,S=!1,A=!0,B=!0,l=30,k=30,E=!0,x=!1,q=!1,N=!1,O=!1,K=!1,v=!1,m,t;const g=[],I=document.getElementById("gameBoard_UI"),C=document.getElementById("rowsInput"),D=document.getElementById("colsInput");
class ha{constructor(a,b){this.x=a;this.y=b;this.neighbors=[];this.cardinal_neighbors=[];this.end_cell=this.start_cell=this.path=this.wall=!1;this.distance=0;this.visited=!1}setNeighbors(){const a=[-1,0,1];for(let d of a)for(let e of a){var b=this.x+d,c=this.y+e;0<=b&&b<k&&0<=c&&c<l&&(0!==d||0!==e)&&(b=0===d&&-1===e?"N":1===d&&-1===e?"NE":1===d&&0===e?"E":1===d&&1===e?"SE":0===d&&1===e?"S":-1===d&&1===e?"SW":-1===d&&0===e?"W":"NW",0===d||0===e?(this.neighbors.push({x:this.x+d,y:this.y+e,connection_cost:1,
direction:b}),this.cardinal_neighbors.push({x:this.x+d,y:this.y+e,connection_cost:1,direction:b})):this.neighbors.push({x:this.x+d,y:this.y+e,connection_cost:Math.sqrt(2),direction:b}))}}getLowestDistanceNeighbor(){let a=Infinity,b=null;for(let c of this.neighbors){let d=g[c.x][c.y];d.distance<a&&d.visited&&!d.wall&&(a=d.distance,b=d)}return b}handleClick(a){if(!E||n||q||0!==a.button)if(!x||n||q||0!==a.button)x||E||!q||n||2!==a.button||(this.wall=!1,h(this.x,this.y).classList.remove("wall"));else for(t=
this,this.end_cell=!0,h(this.x,this.y).classList.add("end"),x=!1,O=!0,document.getElementById("endMessage").classList.add("hidden"),document.getElementById("wallMessage").classList.remove("hidden"),q=!0,a=0;a<k;a++)for(let b=0;b<l;b++)h(a,b).addEventListener("mouseover",W);else this.start_cell=!0,h(this.x,this.y).classList.add("start"),m=this,E=!1,N=x=!0,document.getElementById("startMessage").classList.add("hidden"),document.getElementById("endMessage").classList.remove("hidden")}}const f={};(function(){document.getElementById("start").addEventListener("click",
Z);document.getElementById("buildGrid").addEventListener("click",ca);document.body.onmousedown=H;document.body.onmousemove=H;document.body.onmouseup=H;document.addEventListener("keydown",ia);document.addEventListener("keyup",ja);C.addEventListener("input",ea);D.addEventListener("input",fa);D.value="30";C.value="30";document.getElementById("start").disabled=!0;document.oncontextmenu=()=>!1;document.draggable=!1;document.ondragstart=function(){return!1};I.draggable=!1;I.ondragstart=function(){return!1}})();
class w{constructor(){this.elements=[]}}w.prototype.enqueue=function(a){this.elements.push(a)};w.prototype.dequeue=function(){return this.elements.shift()};w.prototype.isEmpty=function(){return 0===this.elements.length};w.prototype.length=function(){return this.elements.length}})();

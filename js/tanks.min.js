(function(){function Q(a){return new Promise(b=>setTimeout(b,a))}function R(a){J();if(K&&!n&&p){var b=a.target;b=[b.id.split("-")[1],b.id.split("-")[2]];let [e,c]=b;b=f[e][c];b.start_cell||b.end_cell||b.wall||(b.wall=!0,a.target.classList.add("wall"))}}function g(a,b){return document.getElementById("cell-"+a+"-"+b)}function L(a=!0){for(let b=0;b<h;b++)for(let e=0;e<k;e++){let c=f[b][e],d=g(b,e);c.path=!1;c.wall||(a&&(c.end_cell=!1,d.classList.remove("end")),d.classList.remove("path"),c.visited=!1,
c.distance=0,d.textContent="")}}function S(a){switch(a.key){case "ArrowLeft":v("W");break;case "ArrowRight":v("E");break;case "ArrowUp":v("N");break;case "ArrowDown":v("S")}}function v(a){let b;for(let e of q.neighbors)if(e.direction===a){b=f[e.x][e.y];break}"undefined"===typeof b||null===b||b.wall||(b.start_cell?(alert("You ran into enemy tank"),w=!0):(L(),b.end_cell=!0,document.getElementById("cell-"+b.x+"-"+b.y).classList.add("end"),q=b,E(q),r&&x(l)))}function T(){let a;for(let b of l.neighbors){let e=
f[b.x][b.y];if(e.end_cell){alert("Enemy crashed into you.");w=!0;return}if(e.path){a=e;break}}l.start_cell=!1;g(l.x,l.y).classList.remove("start");l.path=!1;a.start_cell=!0;l=a;g(a.x,a.y).classList.add("start");L(!1);E(q);r&&x(l)}function J(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function U(){if(M&&N&&!n){J();var a=document.getElementById("start");a.removeEventListener("click",a);a.disabled=!0;a.blur();document.getElementById("wallMessage").classList.add("notShown");
n=!0;p=!1;E(q);for(a=0;a<h;a++)for(var b=0;b<k;b++)g(a,b).classList.remove("cell_hover");if(r){x(l);for(a=0;a<h;a++)for(b=0;b<k;b++){let e=f[a][b];e.visited||(e.wall=!0,g(a,b).classList.add("wall"))}window.focus();O()}else r||(document.getElementById("wallMessage").classList.add("hidden"),document.getElementById("noPathMessage").classList.remove("hidden"))}}function O(){w||(T(),w||Q(1E3).then(()=>O()))}function x(a){a.path=!0;0!==a.distance&&(a.start_cell||(g(a.x,a.y).classList.remove("visited"),
g(a.x,a.y).classList.add("path")),x(a.getLowestDistanceNeighbor()))}function E(a){let b=1,e=new t;a.visited=!0;for(e.enqueue(a);!e.isEmpty();){b++;a=e.dequeue();for(let c of a.neighbors.reverse()){let d=f[c.x][c.y];"NE"===c.direction&&y("N","E",a,"NE")?a.neighbors.splice(a.neighbors.indexOf(c),1):"SE"===c.direction&&y("S","E",a,"SE")?a.neighbors.splice(a.neighbors.indexOf(c),1):"SW"===c.direction&&y("S","W",a,"SW")?a.neighbors.splice(a.neighbors.indexOf(c),1):"NW"===c.direction&&y("N","W",a,"NW")?
a.neighbors.splice(a.neighbors.indexOf(c),1):(d.start_cell&&(r=!0),d.distance>a.distance+c.connection_cost&&d.visited&&(d.distance=a.distance+c.connection_cost),d.visited||d.wall||(d.visited=!0,d.distance=a.distance+c.connection_cost,g(d.x,d.y),d.wall||e.enqueue(d)))}}}function y(a,b,e,c){let d=null,u=null,F=null;for(let m of e.neighbors)m.direction===a&&(d=f[m.x][m.y]),m.direction===b&&(u=f[m.x][m.y]),m.direction===c&&(F=f[m.x][m.y]);return null===d||null===u||null===F?!1:d.wall&&u.wall?!F.wall:
!1}function V(a){!n&&z&&A&&!P&&(h=Number(B.value),k=Number(C.value),B.disabled=!0,C.disabled=!0,a.target.classList.add("hidden"),document.getElementById("start").disabled=!1,document.getElementById("start").classList.remove("hidden"),W(),P=!0,document.getElementById("startMessage").classList.remove("hidden"))}function X(a){/^\d{0,2}$/.test(a.target.value)&&75>=Number(a.target.value)&&0<Number(a.target.value)&&""!==a.target.value?(z=!0,a=document.getElementById("invalidRows"),"undefined"!=typeof a&&
null!=a&&a.remove()):(z&&(a=document.createElement("p"),a.id="invalidRows",a.textContent="Valid range is 1-75 rows",a.classList.add("bad"),document.getElementById("messages").insertBefore(a,document.getElementById("messages").firstChild)),z=!1)}function Y(a){/^\d{0,2}$/.test(a.target.value)&&75>=Number(a.target.value)&&0<Number(a.target.value)&&""!==a.target.value?(A=!0,a=document.getElementById("invalidCols"),"undefined"!=typeof a&&null!=a&&a.remove()):(A&&(a=document.createElement("p"),a.id="invalidCols",
a.textContent="Valid range is 1-75 columns",a.classList.add("bad"),document.getElementById("messages").insertBefore(a,document.getElementById("messages").firstChild)),A=!1)}function G(a){K=void 0===a.buttons?1===a.which:1===a.buttons}function W(){for(let a=0;a<k;a++){f.push([]);const b=document.createElement("div");b.id="col-"+a;b.classList.add("col");b.draggable=!1;b.ondragstart=function(){return!1};H.appendChild(b);for(let e=0;e<h;e++){const c=new Z(a,e);f[a].push(c);f[a][e].setNeighbors();const d=
document.createElement("div");d.id="cell-"+a+"-"+e;d.classList.add("cell");d.classList.add("cell_hover");625>k*h?d.classList.add("large_cell"):1600>k*h?d.classList.add("medium_cell"):3600>k*h?d.classList.add("small_cell"):d.classList.add("x-small_cell");b.appendChild(d);d.addEventListener("mouseup",u=>c.handleClick(u));d.draggable=!1;d.ondragstart=function(){return!1}}}}let n=!1,w=!1,P=!1,z=!0,A=!0,h=30,k=30,I=!0,D=!1,p=!1,M=!1,N=!1,K=!1,r=!1,l,q;const f=[],H=document.getElementById("gameBoard_UI"),
B=document.getElementById("rowsInput"),C=document.getElementById("colsInput");class Z{constructor(a,b){this.x=a;this.y=b;this.neighbors=[];this.cardinal_neighbors=[];this.end_cell=this.start_cell=this.path=this.wall=!1;this.distance=0;this.visited=!1}setNeighbors(){const a=[-1,0,1];for(let c of a)for(let d of a){var b=this.x+c,e=this.y+d;0<=b&&b<k&&0<=e&&e<h&&(0!==c||0!==d)&&(b=0===c&&-1===d?"N":1===c&&-1===d?"NE":1===c&&0===d?"E":1===c&&1===d?"SE":0===c&&1===d?"S":-1===c&&1===d?"SW":-1===c&&0===
d?"W":"NW",0===c||0===d?(this.neighbors.push({x:this.x+c,y:this.y+d,connection_cost:1,direction:b}),this.cardinal_neighbors.push({x:this.x+c,y:this.y+d,connection_cost:1,direction:b})):this.neighbors.push({x:this.x+c,y:this.y+d,connection_cost:Math.sqrt(2),direction:b}))}}getLowestDistanceNeighbor(){let a=Infinity,b=null;for(let e of this.neighbors){let c=f[e.x][e.y];c.distance<a&&c.visited&&!c.wall&&(a=c.distance,b=c)}return b}handleClick(a){if(!I||n||p||0!==a.button)if(!D||n||p||0!==a.button)D||
I||!p||n||2!==a.button||(this.wall=!1,g(this.x,this.y).classList.remove("wall"));else for(q=this,this.end_cell=!0,g(this.x,this.y).classList.add("end"),D=!1,N=!0,document.getElementById("endMessage").classList.add("hidden"),document.getElementById("wallMessage").classList.remove("hidden"),p=!0,a=0;a<k;a++)for(let b=0;b<h;b++)g(a,b).addEventListener("mouseover",R);else this.start_cell=!0,g(this.x,this.y).classList.add("start"),l=this,I=!1,M=D=!0,document.getElementById("startMessage").classList.add("hidden"),
document.getElementById("endMessage").classList.remove("hidden")}}(function(){document.getElementById("start").addEventListener("click",U);document.getElementById("buildGrid").addEventListener("click",V);document.body.onmousedown=G;document.body.onmousemove=G;document.body.onmouseup=G;document.addEventListener("keydown",S);B.addEventListener("input",X);C.addEventListener("input",Y);C.value="30";B.value="30";document.getElementById("start").disabled=!0;document.oncontextmenu=()=>!1;document.draggable=
!1;document.ondragstart=function(){return!1};H.draggable=!1;H.ondragstart=function(){return!1}})();class t{constructor(){this.elements=[]}}t.prototype.enqueue=function(a){this.elements.push(a)};t.prototype.dequeue=function(){return this.elements.shift()};t.prototype.isEmpty=function(){return 0===this.elements.length};t.prototype.length=function(){return this.elements.length}})();
